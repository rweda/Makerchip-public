<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <meta http-equiv="description" content="design.m4out.html">
   <meta http-equiv="keywords" content="tl-verilog">

   <title>design.m4out.tlv</title>

   <link rel="stylesheet" href="tlx.css" />
</head>

<body>

<h2>design.m4out.tlv</h2>

<pre>
<span class="line" line-num="1" source-line-num="1"><span class="tlv_ident_keyword1">\TLV_version 1b: tl-x.org</span></span>
<span class="line" line-num="2" source-line-num="2"><span class="tlv_ident_keyword1">\SV</span></span>
<span class="line" line-num="3" source-line-num="3"><span class="tlv_ident_comment">/*</span></span>
<span class="line" line-num="4" source-line-num="4"><span class="tlv_ident_comment">Copyright (c) 2015, Steven F. Hoover</span></span>
<span class="line" line-num="5" source-line-num="5"></span>
<span class="line" line-num="6" source-line-num="6"><span class="tlv_ident_comment">Redistribution and use in source and binary forms, with or without</span></span>
<span class="line" line-num="7" source-line-num="7"><span class="tlv_ident_comment">modification, are permitted provided that the following conditions are met:</span></span>
<span class="line" line-num="8" source-line-num="8"></span>
<span class="line" line-num="9" source-line-num="9">    <span class="tlv_ident_comment">* Redistributions of source code must retain the above copyright notice,</span></span>
<span class="line" line-num="10" source-line-num="10">      <span class="tlv_ident_comment">this list of conditions and the following disclaimer.</span></span>
<span class="line" line-num="11" source-line-num="11">    <span class="tlv_ident_comment">* Redistributions in binary form must reproduce the above copyright</span></span>
<span class="line" line-num="12" source-line-num="12">      <span class="tlv_ident_comment">notice, this list of conditions and the following disclaimer in the</span></span>
<span class="line" line-num="13" source-line-num="13">      <span class="tlv_ident_comment">documentation and/or other materials provided with the distribution.</span></span>
<span class="line" line-num="14" source-line-num="14">    <span class="tlv_ident_comment">* The name of Steven F. Hoover</span></span>
<span class="line" line-num="15" source-line-num="15">      <span class="tlv_ident_comment">may not be used to endorse or promote products derived from this software</span></span>
<span class="line" line-num="16" source-line-num="16">      <span class="tlv_ident_comment">without specific prior written permission.</span></span>
<span class="line" line-num="17" source-line-num="17"></span>
<span class="line" line-num="18" source-line-num="18"><span class="tlv_ident_comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></span>
<span class="line" line-num="19" source-line-num="19"><span class="tlv_ident_comment">AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></span>
<span class="line" line-num="20" source-line-num="20"><span class="tlv_ident_comment">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></span>
<span class="line" line-num="21" source-line-num="21"><span class="tlv_ident_comment">DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE</span></span>
<span class="line" line-num="22" source-line-num="22"><span class="tlv_ident_comment">FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span></span>
<span class="line" line-num="23" source-line-num="23"><span class="tlv_ident_comment">DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></span>
<span class="line" line-num="24" source-line-num="24"><span class="tlv_ident_comment">SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span></span>
<span class="line" line-num="25" source-line-num="25"><span class="tlv_ident_comment">CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span></span>
<span class="line" line-num="26" source-line-num="26"><span class="tlv_ident_comment">OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></span>
<span class="line" line-num="27" source-line-num="27"><span class="tlv_ident_comment">OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span>
<span class="line" line-num="28" source-line-num="28"><span class="tlv_ident_comment">*/</span></span>
<span class="line" line-num="29" source-line-num="29"></span>
<span class="line" line-num="30" source-line-num="30"></span>
<span class="line" line-num="31" source-line-num="31"></span>
<span class="line" line-num="32" source-line-num="32"><span class="tlv_ident_comment">// This example accumulates distance traveled in a series of hops.</span></span>
<span class="line" line-num="33" source-line-num="33"><span class="tlv_ident_comment">// Hops are presented as $aa and $bb, a forward distance (along the line of the</span></span>
<span class="line" line-num="34" source-line-num="34"><span class="tlv_ident_comment">// previous hop), and a sideways distance to</span></span>
<span class="line" line-num="35" source-line-num="35"><span class="tlv_ident_comment">// the next target location.  If a new &quot;skip-to&quot; hop arrives next (and it must arrive</span></span>
<span class="line" line-num="36" source-line-num="36"><span class="tlv_ident_comment">// precisely four cycles later), this hop's target is skipped and replaced by the</span></span>
<span class="line" line-num="37" source-line-num="37"><span class="tlv_ident_comment">// destination provided in the skip-to hop (which is given relative to this target).</span></span>
<span class="line" line-num="38" source-line-num="38"><span class="tlv_ident_comment">// The next hop (or skip-hop) is given relative to the corrected hop.</span></span>
<span class="line" line-num="39" source-line-num="39"></span>
<span class="line" line-num="40" source-line-num="40"><span class="tlv_ident_comment">// The incoming stream of hops from the &quot;Stimulus&quot; code in this file are</span></span>
<span class="line" line-num="41" source-line-num="41"><span class="tlv_ident_comment">// passed through a FIFO to be delivered into the pipeline.</span></span>
<span class="line" line-num="42" source-line-num="42"></span>
<span class="line" line-num="43" source-line-num="43"><span class="tlv_ident_hdl_code">module distance(input logic clk, logic reset, output logic passed, output logic failed);    bit [256+63:0] RW_rand_vect; pseudo_rand #(.WIDTH(257)) pseudo_rand (clk, reset, RW_rand_vect[256:0]); assign RW_rand_vect[256+63:257] = RW_rand_vect[62:0];</span></span>
<span class="line" line-num="44" source-line-num="44"></span>
<span class="line" line-num="45" source-line-num="45"><span class="tlv_ident_keyword1">\TLV</span></span>
<span class="line" line-num="46" source-line-num="46"></span>
<span class="line" line-num="47" source-line-num="47">   <span class="tlv_ident_pipeline">|reset</span></span>
<span class="line" line-num="48" source-line-num="48">      <span class="tlv_ident_stage_expr">@-1</span></span>
<span class="line" line-num="49" source-line-num="49">         <span class="tlv_ident_comment">// Create pipesignal out of reset module input.</span></span>
<span class="line" line-num="50" source-line-num="50">         <span class="tlv_ident_assigned_pipe_sig">$reset </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">reset;</span></span>
<span class="line" line-num="51" source-line-num="51"></span>
<span class="line" line-num="52" source-line-num="52">   <span class="tlv_ident_comment">// Stimulus</span></span>
<span class="line" line-num="53" source-line-num="53">   <span class="tlv_ident_pipeline">|in</span></span>
<span class="line" line-num="54" source-line-num="54">      <span class="tlv_ident_stage_expr">@0</span></span>
<span class="line" line-num="55" source-line-num="55">         <span class="tlv_ident_assigned_pipe_sig">$rand_valid</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">RW_rand_vect[0 + (0) % 257 +: 1];</span></span>
<span class="line" line-num="56" source-line-num="56">         <span class="tlv_ident_assigned_pipe_sig">$valid </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$rand_valid </span><span class="tlv_ident_hdl_code">&amp;&amp; !</span><span class="tlv_ident_pipe_sig">$blocked </span><span class="tlv_ident_hdl_code">&amp;&amp; !</span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|reset</span><span class="tlv_ident_pipe_sig">$reset</span><span class="tlv_ident_alignment_expr_1ab">#+0</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="57" source-line-num="57">         <span class="tlv_ident_assigned_pipe_sig">$trans_avail </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$valid</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="58" source-line-num="58">         <span class="tlv_ident_assigned_pipe_sig">$trans_valid </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$trans_avail</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="59" source-line-num="59">         <span class="tlv_ident_assigned_pipe_sig">$rand_skip_to</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">RW_rand_vect[124 + (0) % 257 +: 1];</span></span>
<span class="line" line-num="60" source-line-num="60">         <span class="tlv_ident_assigned_pipe_sig">$skip_to </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$valid </span><span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_pipe_sig">$valid</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_pipe_sig">$rand_skip_to</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="61" source-line-num="61">              <span class="tlv_ident_comment">// Only if last cycle generated a valid, so we know there's a hop to chase.</span></span>
<span class="line" line-num="62" source-line-num="62">         <span class="tlv_ident_when">?$valid</span></span>
<span class="line" line-num="63" source-line-num="63">            <span class="tlv_ident_assigned_pipe_sig">$rand_aa</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">14</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">RW_rand_vect[248 + (0) % 257 +: 15];</span></span>
<span class="line" line-num="64" source-line-num="64">            <span class="tlv_ident_assigned_pipe_sig">$rand_bb</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">14</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">RW_rand_vect[115 + (0) % 257 +: 15];</span></span>
<span class="line" line-num="65" source-line-num="65">            <span class="tlv_ident_assigned_pipe_sig">$aa</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= {17'b0, </span><span class="tlv_ident_pipe_sig">$rand_aa</span><span class="tlv_ident_hdl_code">};</span></span>
<span class="line" line-num="66" source-line-num="66">            <span class="tlv_ident_assigned_pipe_sig">$bb</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= {17'b0, </span><span class="tlv_ident_pipe_sig">$rand_bb</span><span class="tlv_ident_hdl_code">};</span></span>
<span class="line" line-num="67" source-line-num="67">   </span>
<span class="line" line-num="68" source-line-num="68">   <span class="tlv_ident_comment">// Input FIFO</span></span>
<span class="line" line-num="69" source-line-num="69">   <span class="tlv_ident_keyword1">\source ./m4/1b/pipeflow_tlv.m4 414   </span><span class="tlv_ident_comment">// Instantiated from stdin, 69 as: m4+flop_fifo(top, in, 0, calc, 0, &gt;top|reset$reset, 0, 5)</span></span>
<span class="line" line-num="70" source-line-num="69">      <span class="tlv_ident_comment">//|default</span></span>
<span class="line" line-num="71" source-line-num="69">      <span class="tlv_ident_comment">//   @0</span></span>
<span class="line" line-num="72" source-line-num="69">      <span class="tlv_ident_keyword1">\SV_plus</span></span>
<span class="line" line-num="73" source-line-num="69">         <span class="tlv_ident_hdl_code">localparam bit [</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$clog2((5)+1)-1:0] full_mark = 5;</span></span>
<span class="line" line-num="74" source-line-num="69">      </span>
<span class="line" line-num="75" source-line-num="69">      <span class="tlv_ident_comment">// FIFO Instantiation</span></span>
<span class="line" line-num="76" source-line-num="69">      </span>
<span class="line" line-num="77" source-line-num="69">      <span class="tlv_ident_comment">// Hierarchy declarations</span></span>
<span class="line" line-num="78" source-line-num="69">      <span class="tlv_ident_pipeline">|in</span></span>
<span class="line" line-num="79" source-line-num="69">         <span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">(5)-1</span><span class="tlv_ident_beh_hier_1">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_beh_hier_1">]</span></span>
<span class="line" line-num="80" source-line-num="69">      <span class="tlv_ident_pipeline">|calc</span></span>
<span class="line" line-num="81" source-line-num="69">         <span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">(5)-1</span><span class="tlv_ident_beh_hier_1">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_beh_hier_1">]</span></span>
<span class="line" line-num="82" source-line-num="69">      </span>
<span class="line" line-num="83" source-line-num="69">      <span class="tlv_ident_comment">// Hierarchy</span></span>
<span class="line" line-num="84" source-line-num="69">      <span class="tlv_ident_pipeline">|in</span></span>
<span class="line" line-num="85" source-line-num="69">         <span class="tlv_ident_stage_expr">@0</span></span>
<span class="line" line-num="86" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$reset </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|reset</span><span class="tlv_ident_pipe_sig">$reset</span><span class="tlv_ident_alignment_expr_1ab">#+0</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="87" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$out_blocked </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|calc</span><span class="tlv_ident_pipe_sig">$blocked</span><span class="tlv_ident_alignment_expr_1ab">#+0</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="88" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$blocked </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$full</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_pipe_sig">$out_blocked</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="89" source-line-num="69">            <span class="tlv_ident_hdl_code">`BOGUS_USE(</span><span class="tlv_ident_pipe_sig">$blocked</span><span class="tlv_ident_hdl_code">)   </span><span class="tlv_ident_comment">// Not required to be consumed elsewhere.</span></span>
<span class="line" line-num="90" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$would_bypass </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$empty</span><span class="tlv_ident_alignment_expr_1ab">#+1</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="91" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$bypass </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$would_bypass </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipe_sig">$out_blocked</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="92" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$push </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$trans_valid </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipe_sig">$bypass</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="93" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$grow   </span><span class="tlv_ident_hdl_code">=   </span><span class="tlv_ident_pipe_sig">$trans_valid </span><span class="tlv_ident_hdl_code">&amp;&amp;   </span><span class="tlv_ident_pipe_sig">$out_blocked</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="94" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$shrink </span><span class="tlv_ident_hdl_code">= ! </span><span class="tlv_ident_pipe_sig">$empty</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipe_sig">$trans_avail </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipe_sig">$out_blocked</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="95" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$valid_count</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$clog2((5)+1)-1</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$reset </span><span class="tlv_ident_hdl_code">? '0</span></span>
<span class="line" line-num="96" source-line-num="69">                                                        <span class="tlv_ident_hdl_code">: </span><span class="tlv_ident_pipe_sig">$valid_count</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">+ (</span></span>
<span class="line" line-num="97" source-line-num="69">                                                             <span class="tlv_ident_pipe_sig">$grow   </span><span class="tlv_ident_hdl_code">? { {(</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$clog2((5)+1)-1){1'b0}}, 1'b1} :</span></span>
<span class="line" line-num="98" source-line-num="69">                                                             <span class="tlv_ident_pipe_sig">$shrink </span><span class="tlv_ident_hdl_code">? '1</span></span>
<span class="line" line-num="99" source-line-num="69">                                                                     <span class="tlv_ident_hdl_code">: '0</span></span>
<span class="line" line-num="100" source-line-num="69">                                                          <span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="101" source-line-num="69">            <span class="tlv_ident_comment">// At least 2 valid entries.</span></span>
<span class="line" line-num="102" source-line-num="69">            <span class="tlv_ident_comment">//$two_valid = | $ValidCount[m4_counter_width-1:1];</span></span>
<span class="line" line-num="103" source-line-num="69">            <span class="tlv_ident_comment">// but logic depth minimized by taking advantage of prev count &gt;= 4.</span></span>
<span class="line" line-num="104" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$two_valid </span><span class="tlv_ident_hdl_code">= | </span><span class="tlv_ident_pipe_sig">$valid_count</span><span class="tlv_ident_alignment_expr_1ab">#+1</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$clog2((5)+1)-1</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">2</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">|| | </span><span class="tlv_ident_pipe_sig">$valid_count[</span><span class="tlv_ident_hdl_code">2</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">1</span><span class="tlv_ident_pipe_sig">]</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="105" source-line-num="69">            <span class="tlv_ident_comment">// These are an optimization of the commented block below to operate on vectors, rather than bits.</span></span>
<span class="line" line-num="106" source-line-num="69">            <span class="tlv_ident_comment">// TODO: Keep optimizing...</span></span>
<span class="line" line-num="107" source-line-num="69">            <span class="tlv_ident_hdl_code">{</span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span><span class="tlv_ident_assigned_pipe_sig">$$prev_entry_was_tail</span><span class="tlv_ident_hdl_code">} = {</span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span><span class="tlv_ident_pipe_sig">$reconstructed_is_tail</span><span class="tlv_ident_alignment_expr_1ab">#+1</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">[3:0], </span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">4</span><span class="tlv_ident_beh_hier_1">]</span><span class="tlv_ident_pipe_sig">$reconstructed_is_tail</span><span class="tlv_ident_alignment_expr_1ab">#+1</span><span class="tlv_ident_hdl_code">} </span><span class="tlv_ident_comment">/* circular &lt;&lt; */</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="108" source-line-num="69">            <span class="tlv_ident_hdl_code">{</span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span><span class="tlv_ident_assigned_pipe_sig">$$push</span><span class="tlv_ident_hdl_code">} = {5{</span><span class="tlv_ident_pipe_sig">$push</span><span class="tlv_ident_hdl_code">}} &amp; </span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span><span class="tlv_ident_pipe_sig">$prev_entry_was_tail</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="109" source-line-num="69">            <span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span></span>
<span class="line" line-num="110" source-line-num="69">               <span class="tlv_ident_comment">// Replaced with optimized versions above:</span></span>
<span class="line" line-num="111" source-line-num="69">               <span class="tlv_ident_comment">// $prev_entry_was_tail = &gt;entry[(entry+(m4_depth)-1)%(m4_depth)]$reconstructed_is_tail#+1;</span></span>
<span class="line" line-num="112" source-line-num="69">               <span class="tlv_ident_comment">// $push = |m4_in_pipe$push &amp;&amp; $prev_entry_was_tail;</span></span>
<span class="line" line-num="113" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$valid </span><span class="tlv_ident_hdl_code">= (</span><span class="tlv_ident_pipe_sig">$reconstructed_valid</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|calc</span><span class="tlv_ident_beh_hier_1">&gt;entry</span><span class="tlv_ident_pipe_sig">$pop</span><span class="tlv_ident_alignment_expr_1ab">#+0</span><span class="tlv_ident_hdl_code">) || </span><span class="tlv_ident_pipe_sig">$push</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="114" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$is_tail </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$trans_valid </span><span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_pipe_sig">$prev_entry_was_tail  </span><span class="tlv_ident_comment">// shift tail</span></span>
<span class="line" line-num="115" source-line-num="69">                                                  <span class="tlv_ident_hdl_code">: </span><span class="tlv_ident_pipe_sig">$reconstructed_is_tail</span><span class="tlv_ident_alignment_expr_1ab">#+1</span><span class="tlv_ident_hdl_code">;  </span><span class="tlv_ident_comment">// retain tail</span></span>
<span class="line" line-num="116" source-line-num="69">               <span class="tlv_ident_assigned_state_sig">$State </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$reset </span><span class="tlv_ident_hdl_code">? 1'b0</span></span>
<span class="line" line-num="117" source-line-num="69">                                          <span class="tlv_ident_hdl_code">: </span><span class="tlv_ident_pipe_sig">$valid </span><span class="tlv_ident_hdl_code">&amp;&amp; ! (</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$two_valid </span><span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_pipe_sig">$is_tail</span><span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="118" source-line-num="69">         <span class="tlv_ident_stage_expr">@1</span></span>
<span class="line" line-num="119" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$empty </span><span class="tlv_ident_hdl_code">= ! </span><span class="tlv_ident_pipe_sig">$two_valid </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipe_sig">$valid_count[</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">]</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="120" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$full </span><span class="tlv_ident_hdl_code">= (</span><span class="tlv_ident_pipe_sig">$valid_count </span><span class="tlv_ident_hdl_code">== full_mark);  </span><span class="tlv_ident_comment">// Could optimize for power-of-two depth.</span></span>
<span class="line" line-num="121" source-line-num="69">         <span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span></span>
<span class="line" line-num="122" source-line-num="69">            <span class="tlv_ident_stage_expr">@1</span></span>
<span class="line" line-num="123" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$prev_entry_state </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">(entry+(5)-1)%(5)</span><span class="tlv_ident_beh_hier_1">]</span><span class="tlv_ident_state_sig">$State</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="124" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$next_entry_state </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">(entry+1)%(5)</span><span class="tlv_ident_beh_hier_1">]</span><span class="tlv_ident_state_sig">$State</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="125" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$reconstructed_is_tail </span><span class="tlv_ident_hdl_code">= (  </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$two_valid </span><span class="tlv_ident_hdl_code">&amp;&amp; (!</span><span class="tlv_ident_state_sig">$State </span><span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_pipe_sig">$prev_entry_state</span><span class="tlv_ident_hdl_code">)) ||</span></span>
<span class="line" line-num="126" source-line-num="69">                                        <span class="tlv_ident_hdl_code">(! </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$two_valid </span><span class="tlv_ident_hdl_code">&amp;&amp; (!</span><span class="tlv_ident_pipe_sig">$next_entry_state </span><span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_state_sig">$State</span><span class="tlv_ident_hdl_code">)) ||</span></span>
<span class="line" line-num="127" source-line-num="69">                                        <span class="tlv_ident_hdl_code">(</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$empty </span><span class="tlv_ident_hdl_code">&amp;&amp; (entry == 0));  </span><span class="tlv_ident_comment">// need a tail when empty for push</span></span>
<span class="line" line-num="128" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$is_head </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_state_sig">$State </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipe_sig">$prev_entry_state</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="129" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$reconstructed_valid </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_state_sig">$State </span><span class="tlv_ident_hdl_code">|| (</span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$two_valid </span><span class="tlv_ident_hdl_code">&amp;&amp; </span><span class="tlv_ident_pipe_sig">$prev_entry_state</span><span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="130" source-line-num="69">      <span class="tlv_ident_comment">// Write data</span></span>
<span class="line" line-num="131" source-line-num="69">      <span class="tlv_ident_pipeline">|in</span></span>
<span class="line" line-num="132" source-line-num="69">         <span class="tlv_ident_stage_expr">@0</span></span>
<span class="line" line-num="133" source-line-num="69">            <span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span></span>
<span class="line" line-num="134" source-line-num="69">               <span class="tlv_ident_comment">//?$push</span></span>
<span class="line" line-num="135" source-line-num="69">               <span class="tlv_ident_comment">//   $aNY = |m4_in_pipe['']m4_trans_hier$ANY;</span></span>
<span class="line" line-num="136" source-line-num="69">               <span class="tlv_ident_assigned_sig_keyword">$ANY </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$push </span><span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_sig_keyword">$ANY </span><span class="tlv_ident_hdl_code">: </span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_comment">/* RETAIN */</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="137" source-line-num="69">      <span class="tlv_ident_comment">// Read data</span></span>
<span class="line" line-num="138" source-line-num="69">      <span class="tlv_ident_pipeline">|calc</span></span>
<span class="line" line-num="139" source-line-num="69">         <span class="tlv_ident_stage_expr">@0</span></span>
<span class="line" line-num="140" source-line-num="69">            <span class="tlv_ident_comment">//$pop  = ! &gt;m4_top|m4_in_pipe$empty#m4_align(m4_in_at + 1, m4_out_at) &amp;&amp; ! $blocked;</span></span>
<span class="line" line-num="141" source-line-num="69">            <span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">*</span><span class="tlv_ident_beh_hier_1">]</span></span>
<span class="line" line-num="142" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$is_head </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_beh_hier_1">&gt;entry</span><span class="tlv_ident_pipe_sig">$is_head</span><span class="tlv_ident_alignment_expr_1ab">#+1</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="143" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$pop  </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$is_head </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipeline">|calc</span><span class="tlv_ident_pipe_sig">$blocked</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="144" source-line-num="69">               <span class="tlv_ident_beh_hier_1">&gt;read_masked</span></span>
<span class="line" line-num="145" source-line-num="69">                  <span class="tlv_ident_assigned_sig_keyword">$ANY </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;entry</span><span class="tlv_ident_pipe_sig">$is_head </span><span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_beh_hier_1">&gt;entry</span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_comment">/* $aNY */ </span><span class="tlv_ident_hdl_code">: '0;</span></span>
<span class="line" line-num="146" source-line-num="69">               <span class="tlv_ident_beh_hier_1">&gt;accum</span></span>
<span class="line" line-num="147" source-line-num="69">                  <span class="tlv_ident_assigned_sig_keyword">$ANY </span><span class="tlv_ident_hdl_code">= ((entry == 0) ? '0 : </span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">(entry+(5)-1)%(5)</span><span class="tlv_ident_beh_hier_1">]&gt;accum</span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_hdl_code">) |</span></span>
<span class="line" line-num="148" source-line-num="69">                             <span class="tlv_ident_beh_hier_1">&gt;entry&gt;read_masked</span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="149" source-line-num="69">            <span class="tlv_ident_beh_hier_1">&gt;head</span></span>
<span class="line" line-num="150" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$trans_avail </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipeline">|calc</span><span class="tlv_ident_pipe_sig">$trans_avail</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="151" source-line-num="69">               <span class="tlv_ident_when">?$trans_avail</span></span>
<span class="line" line-num="152" source-line-num="69">                  <span class="tlv_ident_assigned_sig_keyword">$ANY </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|calc</span><span class="tlv_ident_beh_hier_1">&gt;entry[</span><span class="tlv_ident_hdl_code">(5)-1</span><span class="tlv_ident_beh_hier_1">]&gt;accum</span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="153" source-line-num="69">      </span>
<span class="line" line-num="154" source-line-num="69">      <span class="tlv_ident_comment">// Bypass</span></span>
<span class="line" line-num="155" source-line-num="69">      <span class="tlv_ident_pipeline">|calc</span></span>
<span class="line" line-num="156" source-line-num="69">         <span class="tlv_ident_stage_expr">@0</span></span>
<span class="line" line-num="157" source-line-num="69">            <span class="tlv_ident_comment">// Available output.  Sometimes it's necessary to know what would be coming to determined</span></span>
<span class="line" line-num="158" source-line-num="69">            <span class="tlv_ident_comment">// if it's blocked.  This can be used externally in that case.</span></span>
<span class="line" line-num="159" source-line-num="69">            <span class="tlv_ident_beh_hier_1">&gt;fifo_head</span></span>
<span class="line" line-num="160" source-line-num="69">               <span class="tlv_ident_assigned_pipe_sig">$trans_avail </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipeline">|calc</span><span class="tlv_ident_pipe_sig">$trans_avail</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="161" source-line-num="69">               <span class="tlv_ident_when">?$trans_avail</span></span>
<span class="line" line-num="162" source-line-num="69">                  </span>
<span class="line" line-num="163" source-line-num="69">                  <span class="tlv_ident_assigned_sig_keyword">$ANY </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$would_bypass</span><span class="tlv_ident_alignment_expr_1ab">#+0</span></span>
<span class="line" line-num="164" source-line-num="69">                               <span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_alignment_expr_1ab">#+0</span></span>
<span class="line" line-num="165" source-line-num="69">                               <span class="tlv_ident_hdl_code">: </span><span class="tlv_ident_pipeline">|calc</span><span class="tlv_ident_beh_hier_1">&gt;head</span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="166" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$trans_avail </span><span class="tlv_ident_hdl_code">= ! </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$would_bypass</span><span class="tlv_ident_alignment_expr_1ab">#+0 </span><span class="tlv_ident_hdl_code">|| </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|in</span><span class="tlv_ident_pipe_sig">$trans_avail</span><span class="tlv_ident_alignment_expr_1ab">#+0</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="167" source-line-num="69">            <span class="tlv_ident_assigned_pipe_sig">$trans_valid </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$trans_avail </span><span class="tlv_ident_hdl_code">&amp;&amp; ! </span><span class="tlv_ident_pipe_sig">$blocked</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="168" source-line-num="69">            <span class="tlv_ident_when">?$trans_valid</span></span>
<span class="line" line-num="169" source-line-num="69">               <span class="tlv_ident_assigned_sig_keyword">$ANY </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;fifo_head</span><span class="tlv_ident_sig_keyword">$ANY</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="170" source-line-num="69">                            </span>
<span class="line" line-num="171" source-line-num="69">                            </span>
<span class="line" line-num="172" source-line-num="69">                            </span>
<span class="line" line-num="173" source-line-num="69">      <span class="tlv_ident_comment">/* Alternate code for pointer indexing.  Replaces $ANY expression above.</span></span>
<span class="line" line-num="174" source-line-num="69">      </span>
<span class="line" line-num="175" source-line-num="69">      <span class="tlv_ident_comment">// Hierarchy</span></span>
<span class="line" line-num="176" source-line-num="69">      <span class="tlv_ident_comment">|in</span></span>
<span class="line" line-num="177" source-line-num="69">         <span class="tlv_ident_comment">&gt;entry2[(5)-1:0]</span></span>
<span class="line" line-num="178" source-line-num="69">      </span>
<span class="line" line-num="179" source-line-num="69">      <span class="tlv_ident_comment">// Head/Tail ptrs.</span></span>
<span class="line" line-num="180" source-line-num="69">      <span class="tlv_ident_comment">|in</span></span>
<span class="line" line-num="181" source-line-num="69">         <span class="tlv_ident_comment">@0</span></span>
<span class="line" line-num="182" source-line-num="69">            <span class="tlv_ident_comment">$NextWrPtr[\$clog2(5)-1:0] =</span></span>
<span class="line" line-num="183" source-line-num="69">                <span class="tlv_ident_comment">$reset       ? '0 :</span></span>
<span class="line" line-num="184" source-line-num="69">                <span class="tlv_ident_comment">$trans_valid ? ($NextWrPtr#+1 == (5 - 1))</span></span>
<span class="line" line-num="185" source-line-num="69">                                 <span class="tlv_ident_comment">? '0</span></span>
<span class="line" line-num="186" source-line-num="69">                                 <span class="tlv_ident_comment">: $NextWrPtr#+1 + {{(\$clog2(5)-1){1'b0}}, 1'b1} :</span></span>
<span class="line" line-num="187" source-line-num="69">                               <span class="tlv_ident_comment">$RETAIN;</span></span>
<span class="line" line-num="188" source-line-num="69">      <span class="tlv_ident_comment">|calc</span></span>
<span class="line" line-num="189" source-line-num="69">         <span class="tlv_ident_comment">@0</span></span>
<span class="line" line-num="190" source-line-num="69">            <span class="tlv_ident_comment">$NextRdPtr[\$clog2(5)-1:0] =</span></span>
<span class="line" line-num="191" source-line-num="69">                <span class="tlv_ident_comment">&gt;top|in$reset#+0</span></span>
<span class="line" line-num="192" source-line-num="69">                             <span class="tlv_ident_comment">? '0 :</span></span>
<span class="line" line-num="193" source-line-num="69">                <span class="tlv_ident_comment">$trans_valid ? ($NextRdPtr#+1 == (5 - 1))</span></span>
<span class="line" line-num="194" source-line-num="69">                                 <span class="tlv_ident_comment">? '0</span></span>
<span class="line" line-num="195" source-line-num="69">                                 <span class="tlv_ident_comment">: $NextRdPtr#+1 + {{(\$clog2(5)-1){1'b0}}, 1'b1} :</span></span>
<span class="line" line-num="196" source-line-num="69">                               <span class="tlv_ident_comment">$RETAIN;</span></span>
<span class="line" line-num="197" source-line-num="69">      <span class="tlv_ident_comment">// Write FIFO</span></span>
<span class="line" line-num="198" source-line-num="69">      <span class="tlv_ident_comment">|in</span></span>
<span class="line" line-num="199" source-line-num="69">         <span class="tlv_ident_comment">@0</span></span>
<span class="line" line-num="200" source-line-num="69">            <span class="tlv_ident_comment">$dummy = '0;</span></span>
<span class="line" line-num="201" source-line-num="69">            <span class="tlv_ident_comment">?$trans_valid</span></span>
<span class="line" line-num="202" source-line-num="69">               <span class="tlv_ident_comment">// This doesn't work because SV complains for FIFOs in replicated context that</span></span>
<span class="line" line-num="203" source-line-num="69">               <span class="tlv_ident_comment">// there are multiple procedures that assign the signals.</span></span>
<span class="line" line-num="204" source-line-num="69">               <span class="tlv_ident_comment">// Array writes can be done in an SV module.</span></span>
<span class="line" line-num="205" source-line-num="69">               <span class="tlv_ident_comment">// The only long-term resolutions are support for module generation and use</span></span>
<span class="line" line-num="206" source-line-num="69">               <span class="tlv_ident_comment">// signals declared within for loops with cross-hierarchy references in SV.</span></span>
<span class="line" line-num="207" source-line-num="69">               <span class="tlv_ident_comment">// TODO: To make a simulation-efficient FIFO, use DesignWare.</span></span>
<span class="line" line-num="208" source-line-num="69">               <span class="tlv_ident_comment">{&gt;entry2[$NextWrPtr#+1]$$ANY} = $ANY;</span></span>
<span class="line" line-num="209" source-line-num="69">      <span class="tlv_ident_comment">// Read FIFO</span></span>
<span class="line" line-num="210" source-line-num="69">      <span class="tlv_ident_comment">|calc</span></span>
<span class="line" line-num="211" source-line-num="69">         <span class="tlv_ident_comment">@0</span></span>
<span class="line" line-num="212" source-line-num="69">            <span class="tlv_ident_comment">&gt;read2</span></span>
<span class="line" line-num="213" source-line-num="69">               <span class="tlv_ident_comment">$trans_valid = |calc$trans_valid;</span></span>
<span class="line" line-num="214" source-line-num="69">               <span class="tlv_ident_comment">?$trans_valid</span></span>
<span class="line" line-num="215" source-line-num="69">                  <span class="tlv_ident_comment">$ANY = &gt;top|in&gt;entry2[|calc$NextRdPtr#+1]$ANY#+0;</span></span>
<span class="line" line-num="216" source-line-num="69">               <span class="tlv_ident_comment">`BOGUS_USE($dummy)</span></span>
<span class="line" line-num="217" source-line-num="69">            <span class="tlv_ident_comment">?$trans_valid</span></span>
<span class="line" line-num="218" source-line-num="69">               <span class="tlv_ident_comment">$ANY = &gt;read2$ANY;</span></span>
<span class="line" line-num="219" source-line-num="69">      <span class="tlv_ident_comment">*/</span></span>
<span class="line" line-num="220" source-line-num="69">   <span class="tlv_ident_keyword1">\end_source</span></span>
<span class="line" line-num="221" source-line-num="70"></span>
<span class="line" line-num="222" source-line-num="71">   <span class="tlv_ident_pipeline">|calc</span></span>
<span class="line" line-num="223" source-line-num="72">      <span class="tlv_ident_stage_expr">@0</span></span>
<span class="line" line-num="224" source-line-num="73">         <span class="tlv_ident_comment">// Block corrections for 3 cycles.</span></span>
<span class="line" line-num="225" source-line-num="74">         <span class="tlv_ident_assigned_pipe_sig">$blocked </span><span class="tlv_ident_hdl_code">= (</span><span class="tlv_ident_pipe_sig">$trans_avail </span><span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_beh_hier_1">&gt;fifo_head</span><span class="tlv_ident_pipe_sig">$skip_to </span><span class="tlv_ident_hdl_code">: 1'b1) &amp;&amp; (</span><span class="tlv_ident_pipe_sig">$valid</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">|| </span><span class="tlv_ident_pipe_sig">$valid</span><span class="tlv_ident_alignment_expr_1ab">#+2 </span><span class="tlv_ident_hdl_code">|| </span><span class="tlv_ident_pipe_sig">$valid</span><span class="tlv_ident_alignment_expr_1ab">#+3</span><span class="tlv_ident_hdl_code">); </span></span>
<span class="line" line-num="226" source-line-num="75">         <span class="tlv_ident_assigned_pipe_sig">$valid </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$trans_valid</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="227" source-line-num="76">         <span class="tlv_ident_assigned_pipe_sig">$reset </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|reset</span><span class="tlv_ident_pipe_sig">$reset</span><span class="tlv_ident_alignment_expr_1ab">#+0</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="228" source-line-num="77">         <span class="tlv_ident_assigned_pipe_sig">$valid_or_reset </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$valid </span><span class="tlv_ident_hdl_code">|| </span><span class="tlv_ident_pipe_sig">$reset</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="229" source-line-num="78">      <span class="tlv_ident_when">?$valid</span></span>
<span class="line" line-num="230" source-line-num="79">         <span class="tlv_ident_comment">// DUT</span></span>
<span class="line" line-num="231" source-line-num="80">         <span class="tlv_ident_stage_expr">@0</span></span>
<span class="line" line-num="232" source-line-num="81">            <span class="tlv_ident_assigned_pipe_sig">$corrected_aa</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$skip_to </span><span class="tlv_ident_hdl_code">? (</span><span class="tlv_ident_pipe_sig">$aa </span><span class="tlv_ident_hdl_code">+ </span><span class="tlv_ident_pipe_sig">$cc</span><span class="tlv_ident_alignment_expr_1ab">#+4</span><span class="tlv_ident_hdl_code">) : </span><span class="tlv_ident_pipe_sig">$aa</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="233" source-line-num="82">         <span class="tlv_ident_stage_next_operator">@++</span></span>
<span class="line" line-num="234" source-line-num="83">            <span class="tlv_ident_assigned_pipe_sig">$aa_squared</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$corrected_aa </span><span class="tlv_ident_hdl_code">* </span><span class="tlv_ident_pipe_sig">$corrected_aa</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="235" source-line-num="84">            <span class="tlv_ident_assigned_pipe_sig">$bb_squared</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$bb </span><span class="tlv_ident_hdl_code">* </span><span class="tlv_ident_pipe_sig">$bb</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="236" source-line-num="85">         <span class="tlv_ident_stage_incr_expr">@+=1</span></span>
<span class="line" line-num="237" source-line-num="86">            <span class="tlv_ident_assigned_pipe_sig">$cc_squared</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$aa_squared </span><span class="tlv_ident_hdl_code">+ </span><span class="tlv_ident_pipe_sig">$bb_squared</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="238" source-line-num="87">         <span class="tlv_ident_stage_expr">@3</span></span>
<span class="line" line-num="239" source-line-num="88">            <span class="tlv_ident_assigned_pipe_sig">$cc</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$sqrt(</span><span class="tlv_ident_pipe_sig">$cc_squared</span><span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="240" source-line-num="89">         <span class="tlv_ident_stage_expr">@4</span></span>
<span class="line" line-num="241" source-line-num="90">            <span class="tlv_ident_assigned_pipe_sig">$tot_incr</span><span class="tlv_ident_pipe_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_pipe_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_pipe_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_state_sig">$TotDist</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">+ </span><span class="tlv_ident_pipe_sig">$cc</span><span class="tlv_ident_hdl_code">;</span></span>
<span class="line" line-num="242" source-line-num="91">      <span class="tlv_ident_when">?$valid_or_reset</span></span>
<span class="line" line-num="243" source-line-num="92">         <span class="tlv_ident_stage_expr">@4</span></span>
<span class="line" line-num="244" source-line-num="93">            <span class="tlv_ident_assigned_state_sig">$TotDist</span><span class="tlv_ident_state_sig">[</span><span class="tlv_ident_hdl_code">31</span><span class="tlv_ident_state_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_state_sig">] </span><span class="tlv_ident_hdl_code">=</span></span>
<span class="line" line-num="245" source-line-num="94">                  <span class="tlv_ident_pipe_sig">$reset                            </span><span class="tlv_ident_hdl_code">? 32'b0     :  </span><span class="tlv_ident_comment">// reset</span></span>
<span class="line" line-num="246" source-line-num="95">                  <span class="tlv_ident_hdl_code">!(</span><span class="tlv_ident_pipe_sig">$valid</span><span class="tlv_ident_alignment_expr_1ab">#-4 </span><span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_pipe_sig">$skip_to</span><span class="tlv_ident_alignment_expr_1ab">#-4 </span><span class="tlv_ident_hdl_code">: 1'b0) ? </span><span class="tlv_ident_pipe_sig">$tot_incr </span><span class="tlv_ident_hdl_code">:  </span><span class="tlv_ident_comment">// add $cc</span></span>
<span class="line" line-num="247" source-line-num="96">                                      <span class="tlv_ident_sig_keyword">$RETAIN</span><span class="tlv_ident_hdl_code">;                     </span><span class="tlv_ident_comment">// retain</span></span>
<span class="line" line-num="248" source-line-num="97"></span>
<span class="line" line-num="249" source-line-num="98"></span>
<span class="line" line-num="250" source-line-num="99">         <span class="tlv_ident_comment">// Output.</span></span>
<span class="line" line-num="251" source-line-num="100">      <span class="tlv_ident_stage_expr">@5</span></span>
<span class="line" line-num="252" source-line-num="101">         <span class="tlv_ident_keyword1">\SV_plus</span></span>
<span class="line" line-num="253" source-line-num="102">            <span class="tlv_ident_hdl_code">always_ff @(posedge clk) begin</span></span>
<span class="line" line-num="254" source-line-num="103">               <span class="tlv_ident_hdl_code">if (</span><span class="tlv_ident_pipe_sig">$valid</span><span class="tlv_ident_hdl_code">) begin</span></span>
<span class="line" line-num="255" source-line-num="104">                  <span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$display(&quot;Cyc %d:</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">\n  </span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$skip_to: %h</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">\n  </span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$aa: 0x%h</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">\n  </span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$bb: 0x%h</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">\n  </span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$cc: 0x%h</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">\n  </span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">$TotDist: 0x%h</span><span class="tlv_ident_sv_sig">\</span><span class="tlv_ident_hdl_code">\n&quot;, </span><span class="tlv_ident_state_sig">$CycCnt</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_pipe_sig">$skip_to</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_pipe_sig">$aa</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_pipe_sig">$bb</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_pipe_sig">$cc</span><span class="tlv_ident_hdl_code">, </span><span class="tlv_ident_state_sig">$TotDist</span><span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="256" source-line-num="105">               <span class="tlv_ident_hdl_code">end</span></span>
<span class="line" line-num="257" source-line-num="106">            <span class="tlv_ident_hdl_code">end</span></span>
<span class="line" line-num="258" source-line-num="107"></span>
<span class="line" line-num="259" source-line-num="108">         <span class="tlv_ident_when">?$valid</span></span>
<span class="line" line-num="260" source-line-num="109">            <span class="tlv_ident_comment">// Checking</span></span>
<span class="line" line-num="261" source-line-num="110">            <span class="tlv_ident_comment">// $cc cannot be less than either $corrected_aa or $bb, and</span></span>
<span class="line" line-num="262" source-line-num="111">            <span class="tlv_ident_comment">// $cc cannot be greater than $corrected_aa + $bb.</span></span>
<span class="line" line-num="263" source-line-num="112">            <span class="tlv_ident_assigned_pipe_sig">$too_big </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_pipe_sig">$cc </span><span class="tlv_ident_hdl_code">&gt; (</span><span class="tlv_ident_pipe_sig">$corrected_aa </span><span class="tlv_ident_hdl_code">+ </span><span class="tlv_ident_pipe_sig">$bb</span><span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="264" source-line-num="113">            <span class="tlv_ident_assigned_pipe_sig">$too_small </span><span class="tlv_ident_hdl_code">= (</span><span class="tlv_ident_pipe_sig">$cc </span><span class="tlv_ident_hdl_code">&lt; </span><span class="tlv_ident_pipe_sig">$corrected_aa</span><span class="tlv_ident_hdl_code">) || (</span><span class="tlv_ident_pipe_sig">$cc </span><span class="tlv_ident_hdl_code">&lt; </span><span class="tlv_ident_pipe_sig">$bb</span><span class="tlv_ident_hdl_code">);</span></span>
<span class="line" line-num="265" source-line-num="114"></span>
<span class="line" line-num="266" source-line-num="115">         <span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">failed = </span><span class="tlv_ident_pipe_sig">$valid </span><span class="tlv_ident_hdl_code">? </span><span class="tlv_ident_pipe_sig">$too_big </span><span class="tlv_ident_hdl_code">|| </span><span class="tlv_ident_pipe_sig">$too_small </span><span class="tlv_ident_hdl_code">: 1'b0;</span></span>
<span class="line" line-num="267" source-line-num="116"></span>
<span class="line" line-num="268" source-line-num="117">      <span class="tlv_ident_stage_expr">@-1</span></span>
<span class="line" line-num="269" source-line-num="118">         <span class="tlv_ident_comment">// Free-running cycle count.</span></span>
<span class="line" line-num="270" source-line-num="119">         <span class="tlv_ident_assigned_state_sig">$CycCnt</span><span class="tlv_ident_state_sig">[</span><span class="tlv_ident_hdl_code">15</span><span class="tlv_ident_state_sig">:</span><span class="tlv_ident_hdl_code">0</span><span class="tlv_ident_state_sig">] </span><span class="tlv_ident_hdl_code">= </span><span class="tlv_ident_beh_hier_1">&gt;top</span><span class="tlv_ident_pipeline">|reset</span><span class="tlv_ident_pipe_sig">$reset</span><span class="tlv_ident_alignment_expr_1ab">#+0 </span><span class="tlv_ident_hdl_code">? 16'b0 : </span><span class="tlv_ident_state_sig">$CycCnt</span><span class="tlv_ident_alignment_expr_1ab">#+1 </span><span class="tlv_ident_hdl_code">+ 16'b1;</span></span>
<span class="line" line-num="271" source-line-num="120"></span>
<span class="line" line-num="272" source-line-num="121">      <span class="tlv_ident_stage_expr">@1</span></span>
<span class="line" line-num="273" source-line-num="122">         <span class="tlv_ident_comment">// Pass the test on cycle 20.</span></span>
<span class="line" line-num="274" source-line-num="123">         <span class="tlv_ident_sv_sig">*</span><span class="tlv_ident_hdl_code">passed = </span><span class="tlv_ident_state_sig">$CycCnt </span><span class="tlv_ident_hdl_code">&gt; 16'd20;</span></span>
<span class="line" line-num="275" source-line-num="124"><span class="tlv_ident_keyword1">\SV</span></span>
<span class="line" line-num="276" source-line-num="125"><span class="tlv_ident_hdl_code">endmodule</span></span>

</pre>

</body>
</html>
